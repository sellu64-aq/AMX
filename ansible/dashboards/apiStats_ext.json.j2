{
  "dashboard": {
    "folderUid": "api777Sel",
    "message": "deployment",
    "overwrite": true,
  "__inputs": [
    {
    "name": "influx_DS",
    "label": "Select InfluxDB Source",
    "description": "Choose the InfluxDB data source (Pri/Sec)",
    "type": "datasource",
    "pluginId": "influxdb",
    "pluginName": "InfluxDB"
    },
    {
      "name": "DS_GCONTROL",
      "label": "GControl",
      "description": "",
      "type": "datasource",
      "pluginId": "mysql",
      "pluginName": "MySQL"
    }
  ],
  "__elements": {},
  "__requires": [
    {
      "type": "grafana",
      "id": "grafana",
      "name": "Grafana",
      "version": "12.0.2"
    },
    {
      "type": "datasource",
      "id": "influxdb",
      "name": "InfluxDB",
      "version": "1.0.0"
    },
    {
      "type": "datasource",
      "id": "mysql",
      "name": "MySQL",
      "version": "12.0.2"
    },
    {
      "type": "panel",
      "id": "table",
      "name": "Table",
      "version": ""
    },
    {
      "type": "panel",
      "id": "timeseries",
      "name": "Time series",
      "version": ""
    }
  ],
  "annotations": {
    "list": [
      {
        "builtIn": 1,
        "datasource": {
          "type": "grafana",
          "uid": "-- Grafana --"
        },
        "enable": true,
        "hide": true,
        "iconColor": "rgba(0, 211, 255, 1)",
        "name": "Annotations & Alerts",
        "type": "dashboard"
      }
    ]
  },
  "editable": true,
  "fiscalYearStartMonth": 0,
  "graphTooltip": 0,
  "id": null,
  "links": [],
  "liveNow": true,
  "panels": [
    {
      "datasource": {
        "type": "influxdb",
        "uid": "${InfluxDS}"
      },
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "thresholds"
          },
          "custom": {
            "align": "left",
            "cellOptions": {
              "type": "auto"
            },
            "inspect": false
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green"
              },
              {
                "color": "red",
                "value": 80
              }
            ]
          }
        },
        "overrides": [
          {
            "matcher": {
              "id": "byName",
              "options": "API"
            },
            "properties": [
              {
                "id": "custom.width",
                "value": 274
              },
              {
                "id": "links",
                "value": [
                  {
                    "targetBlank": true,
                    "title": "API_Error",
                    "url": "/d/eaP_e3hnzh/ext-api-error-details?${__url_time_range}&orgId=1&var-API=${__data.fields.API}"
                  }
                ]
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "Total Success"
            },
            "properties": [
              {
                "id": "custom.width",
                "value": 114
              },
              {
                "id": "custom.cellOptions",
                "value": {
                  "type": "color-background"
                }
              },
              {
                "id": "color",
                "value": {
                  "fixedColor": "#198f10",
                  "mode": "shades"
                }
              },
              {
                "id": "links",
                "value": [
                  {
                    "targetBlank": true,
                    "title": "API_External",
                    "url": "/d/eaP_e3hnzh/ext-api-error-details?${__url_time_range}&orgId=1&var-API=${__data.fields.API}"
                  }
                ]
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "Total Fail"
            },
            "properties": [
              {
                "id": "custom.width",
                "value": 88
              },
              {
                "id": "custom.cellOptions",
                "value": {
                  "type": "color-background"
                }
              },
              {
                "id": "color",
                "value": {
                  "fixedColor": "#bf2323",
                  "mode": "shades"
                }
              },
              {
                "id": "links",
                "value": [
                  {
                    "targetBlank": true,
                    "title": "API_External",
                    "url": "/d/eaP_e3hnzh/ext-api-error-details?${__url_time_range}&orgId=1&var-API=${__data.fields.API}"
                  }
                ]
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "Total Requests"
            },
            "properties": [
              {
                "id": "custom.width",
                "value": 119
              },
              {
                "id": "custom.cellOptions",
                "value": {
                  "type": "color-background"
                }
              },
              {
                "id": "color",
                "value": {
                  "fixedColor": "#06746e00",
                  "mode": "shades"
                }
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "Success %"
            },
            "properties": [
              {
                "id": "custom.width",
                "value": 106
              },
              {
                "id": "custom.cellOptions",
                "value": {
                  "type": "color-background"
                }
              },
              {
                "id": "thresholds",
                "value": {
                  "mode": "absolute",
                  "steps": [
                    {
                      "color": "semi-dark-red"
                    },
                    {
                      "color": "#EAB839",
                      "value": 50
                    },
                    {
                      "color": "#EF843C",
                      "value": 75
                    },
                    {
                      "color": "semi-dark-green",
                      "value": 90
                    }
                  ]
                }
              },
              {
                "id": "unit",
                "value": "percent"
              }
            ]
          }
        ]
      },
      "gridPos": {
        "h": 8,
        "w": 12,
        "x": 0,
        "y": 0
      },
      "id": 2,
      "options": {
        "cellHeight": "sm",
        "footer": {
          "countRows": false,
          "fields": "",
          "reducer": [
            "sum"
          ],
          "show": false
        },
        "showHeader": true,
        "sortBy": []
      },
      "pluginVersion": "12.0.2",
      "targets": [
        {
          "datasource": {
            "type": "influxdb",
            "uid": "${DS_DALLAS_PRI}"
          },
          "hide": false,
          "query": "SELECT\n  sum(\"success_count\") AS \"Total Success\",\n  sum(\"fail_count\") AS \"Total Fail\",\n  sum(\"total\") AS \"Total Requests\",\n  (sum(\"success_count\") / sum(\"total\")) * 100 AS \"Success %\"\nFROM \"DB_External_API_Stats\"\nWHERE\n  $timeFilter\nGROUP BY \"API\" fill(null)\n",
          "rawQuery": true,
          "refId": "A",
          "resultFormat": "table"
        }
      ],
      "title": "External API Stats",
      "transformations": [
        {
          "id": "organize",
          "options": {
            "excludeByName": {
              "Time": true
            },
            "includeByName": {},
            "indexByName": {},
            "renameByName": {
              "External_API": "API"
            }
          }
        }
      ],
      "type": "table"
    },
    {
      "datasource": {
        "type": "mysql",
        "uid": "${DS_GCONTROL}"
      },
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "palette-classic"
          },
          "custom": {
            "axisBorderShow": false,
            "axisCenteredZero": false,
            "axisColorMode": "text",
            "axisLabel": "",
            "axisPlacement": "auto",
            "barAlignment": 0,
            "barWidthFactor": 0.6,
            "drawStyle": "bars",
            "fillOpacity": 31,
            "gradientMode": "none",
            "hideFrom": {
              "legend": false,
              "tooltip": false,
              "viz": false
            },
            "insertNulls": false,
            "lineInterpolation": "linear",
            "lineWidth": 1,
            "pointSize": 5,
            "scaleDistribution": {
              "type": "linear"
            },
            "showPoints": "auto",
            "spanNulls": false,
            "stacking": {
              "group": "A",
              "mode": "none"
            },
            "thresholdsStyle": {
              "mode": "off"
            }
          },
          "decimals": 0,
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green"
              },
              {
                "color": "red",
                "value": 80
              }
            ]
          }
        },
        "overrides": [
          {
            "matcher": {
              "id": "byName",
              "options": "Total Requests"
            },
            "properties": [
              {
                "id": "color",
                "value": {
                  "fixedColor": "#06746e00",
                  "mode": "shades"
                }
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "Success %"
            },
            "properties": [
              {
                "id": "thresholds",
                "value": {
                  "mode": "absolute",
                  "steps": [
                    {
                      "color": "semi-dark-red"
                    },
                    {
                      "color": "#EAB839",
                      "value": 50
                    },
                    {
                      "color": "#EF843C",
                      "value": 75
                    },
                    {
                      "color": "#208912",
                      "value": 90
                    }
                  ]
                }
              },
              {
                "id": "unit",
                "value": "percent"
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "API"
            },
            "properties": [
              {
                "id": "links",
                "value": [
                  {
                    "targetBlank": true,
                    "title": "API Error Details",
                    "url": "http://10.221.92.106:3000/d/fd1d549d-eefb-4b6a-97b0-2aa3f82d0d4b/ol-error-details?${__url_time_range}&orgId=1&var-API=${__data.fields.API}"
                  }
                ]
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "Success"
            },
            "properties": [
              {
                "id": "color",
                "value": {
                  "fixedColor": "semi-dark-green",
                  "mode": "shades"
                }
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "Failures"
            },
            "properties": [
              {
                "id": "color",
                "value": {
                  "fixedColor": "semi-dark-red",
                  "mode": "shades"
                }
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "Total"
            },
            "properties": [
              {
                "id": "color",
                "value": {
                  "fixedColor": "#22a8bc",
                  "mode": "shades"
                }
              }
            ]
          }
        ]
      },
      "gridPos": {
        "h": 8,
        "w": 12,
        "x": 12,
        "y": 0
      },
      "id": 5,
      "options": {
        "legend": {
          "calcs": [
            "min",
            "mean",
            "max",
            "sum",
            "lastNotNull"
          ],
          "displayMode": "table",
          "placement": "bottom",
          "showLegend": true
        },
        "tooltip": {
          "hideZeros": false,
          "mode": "single",
          "sort": "none"
        }
      },
      "pluginVersion": "12.0.2",
      "targets": [
        {
          "dataset": "aa",
          "datasource": {
            "type": "mysql",
            "uid": "${DS_GCONTROL}"
          },
          "editorMode": "code",
          "format": "table",
          "hide": true,
          "rawQuery": true,
          "rawSql": "SELECT\n    SUM(\n        CASE\n            WHEN RESULT = 'success'\n              OR message IN (\n                  'Data not found.', 'No Data Usage found for given duration',\n                  'Device Details Not found', 'Error while validating the request parameters.',\n                  'Configuration or connectivity issue found.(null)', 'Invalid ICCID',\n                  'Token is invalid or expired', 'APN old and new is same : 201',\n                  'APN old and new is same : 200', 'APN old and new is same : 202',\n                  'APN is not associated with this asset : 202',\n                  'Operation Not Allowed on single or no APN association on SIM',\n                  'Service plan operation failed.', 'Device plan not found.'\n              )\n            THEN 1 ELSE 0\n        END\n    ) AS success_count,\n\n    SUM(\n        CASE\n            WHEN RESULT = 'Failed'\n              AND message NOT IN (\n                  'Data not found.', 'No Data Usage found for given duration',\n                  'Device Details Not found', 'Error while validating the request parameters.',\n                  'Configuration or connectivity issue found.(null)', 'Invalid ICCID',\n                  'Token is invalid or expired', 'APN old and new is same : 201',\n                  'APN old and new is same : 200', 'APN old and new is same : 202',\n                  'APN is not associated with this asset : 202',\n                  'Operation Not Allowed on single or no APN association on SIM',\n                  'Service plan operation failed.', 'Device plan not found.'\n              )\n            THEN 1 ELSE 0\n        END\n    ) AS fail_count,\n\n    COUNT(*) AS total_count,\n\n    ROUND(\n        (\n            SUM(\n                CASE\n                    WHEN RESULT = 'success'\n                      OR message IN (\n                          'Data not found.', 'No Data Usage found for given duration',\n                          'Device Details Not found', 'Error while validating the request parameters.',\n                          'Configuration or connectivity issue found.(null)', 'Invalid ICCID',\n                          'Token is invalid or expired', 'APN old and new is same : 201',\n                          'APN old and new is same : 200', 'APN old and new is same : 202',\n                          'APN is not associated with this asset : 202',\n                          'Operation Not Allowed on single or no APN association on SIM',\n                          'Service plan operation failed.', 'Device plan not found.'\n                      )\n                    THEN 1 ELSE 0\n                END\n            ) / COUNT(*)\n        ) * 100,\n        2\n    ) AS success_rate\n\nFROM auditlog_api_transaction\nWHERE\n    $__timeFilter(CREATE_DATE)\n    AND API_NAME IS NOT NULL;\n",
          "refId": "A",
          "sql": {
            "columns": [
              {
                "parameters": [],
                "type": "function"
              }
            ],
            "groupBy": [
              {
                "property": {
                  "type": "string"
                },
                "type": "groupBy"
              }
            ],
            "limit": 50
          }
        },
        {
          "dataset": "amx_cdr_database",
          "datasource": {
            "type": "mysql",
            "uid": "${DS_GCONTROL}"
          },
          "editorMode": "code",
          "format": "table",
          "hide": false,
          "rawQuery": true,
          "rawSql": "SELECT\n    FROM_UNIXTIME(FLOOR(UNIX_TIMESTAMP(CREATE_DATE) / 60) * 60) AS \"time\",\n    \n    SUM(\n        CASE\n            WHEN RESULT = 'success'\n              OR message IN (\n                  'Data not found.', 'No Data Usage found for given duration',\n                  'Device Details Not found', 'Error while validating the request parameters.',\n                  'Configuration or connectivity issue found.(null)', 'Invalid ICCID',\n                  'Token is invalid or expired', 'APN old and new is same : 201',\n                  'APN old and new is same : 200', 'APN old and new is same : 202',\n                  'APN is not associated with this asset : 202',\n                  'Operation Not Allowed on single or no APN association on SIM',\n                  'Service plan operation failed.', 'Device plan not found.'\n              )\n            THEN 1 ELSE 0\n        END\n    ) AS success_count,\n\n    SUM(\n        CASE\n            WHEN RESULT = 'Failed'\n              AND message NOT IN (\n                  'Data not found.', 'No Data Usage found for given duration',\n                  'Device Details Not found', 'Error while validating the request parameters.',\n                  'Configuration or connectivity issue found.(null)', 'Invalid ICCID',\n                  'Token is invalid or expired', 'APN old and new is same : 201',\n                  'APN old and new is same : 200', 'APN old and new is same : 202',\n                  'APN is not associated with this asset : 202',\n                  'Operation Not Allowed on single or no APN association on SIM',\n                  'Service plan operation failed.', 'Device plan not found.'\n              )\n            THEN 1 ELSE 0\n        END\n    ) AS fail_count,\n\n    COUNT(*) AS total_count,\n\n    ROUND(\n        (\n            SUM(\n                CASE\n                    WHEN RESULT = 'success'\n                      OR message IN (\n                          'Data not found.', 'No Data Usage found for given duration',\n                          'Device Details Not found', 'Error while validating the request parameters.',\n                          'Configuration or connectivity issue found.(null)', 'Invalid ICCID',\n                          'Token is invalid or expired', 'APN old and new is same : 201',\n                          'APN old and new is same : 200', 'APN old and new is same : 202',\n                          'APN is not associated with this asset : 202',\n                          'Operation Not Allowed on single or no APN association on SIM',\n                          'Service plan operation failed.', 'Device plan not found.'\n                      )\n                    THEN 1 ELSE 0\n                END\n            ) / COUNT(*)\n        ) * 100,\n        2\n    ) AS success_rate\n\nFROM auditlog_api_transaction\nWHERE\n    $__timeFilter(CREATE_DATE)\n    AND API_NAME IS NOT NULL\nGROUP BY FLOOR(UNIX_TIMESTAMP(CREATE_DATE) / 60)\nORDER BY time ASC;\n",
          "refId": "B",
          "sql": {
            "columns": [
              {
                "parameters": [],
                "type": "function"
              }
            ],
            "groupBy": [
              {
                "property": {
                  "type": "string"
                },
                "type": "groupBy"
              }
            ],
            "limit": 50
          }
        }
      ],
      "title": "External API Transaction Trend",
      "transformations": [
        {
          "id": "organize",
          "options": {
            "excludeByName": {
              "Percent": false,
              "Time": true,
              "serviceNameAlias": true,
              "success_rate": true,
              "total_count": true
            },
            "includeByName": {},
            "indexByName": {},
            "renameByName": {
              "fail_count": "Failures",
              "serviceName": "API",
              "success_count": "Success",
              "success_percentage": "Success %",
              "success_rate": "Success %",
              "total_count": "Total"
            }
          }
        },
        {
          "id": "calculateField",
          "options": {
            "alias": "Percent",
            "binary": {
              "left": {
                "matcher": {
                  "id": "byName",
                  "options": "okCount"
                }
              },
              "operator": "/",
              "right": {
                "matcher": {
                  "id": "byName",
                  "options": "totalCount"
                }
              }
            },
            "mode": "binary",
            "reduce": {
              "reducer": "sum"
            },
            "replaceFields": false,
            "unary": {
              "fieldName": "okCount",
              "operator": "abs"
            }
          }
        },
        {
          "id": "calculateField",
          "options": {
            "alias": "Success %",
            "binary": {
              "left": {
                "matcher": {
                  "id": "byName",
                  "options": "Percent"
                }
              },
              "operator": "*",
              "right": {
                "fixed": "100"
              }
            },
            "mode": "binary",
            "reduce": {
              "reducer": "sum"
            }
          }
        },
        {
          "id": "organize",
          "options": {
            "excludeByName": {
              "Percent": true
            },
            "includeByName": {},
            "indexByName": {},
            "renameByName": {}
          }
        },
        {
          "id": "convertFieldType",
          "options": {
            "conversions": [
              {
                "destinationType": "number",
                "targetField": "Success %"
              }
            ],
            "fields": {}
          }
        }
      ],
      "type": "timeseries"
    },
    {
      "datasource": {
        "type": "mysql",
        "uid": "${DS_GCONTROL}"
      },
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "thresholds"
          },
          "custom": {
            "align": "auto",
            "cellOptions": {
              "type": "auto"
            },
            "filterable": true,
            "inspect": false
          },
          "decimals": 2,
          "displayName": "",
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green"
              },
              {
                "color": "red",
                "value": 80
              }
            ]
          },
          "unit": "none"
        },
        "overrides": [
          {
            "matcher": {
              "id": "byName",
              "options": "Time"
            },
            "properties": [
              {
                "id": "displayName",
                "value": "Time"
              },
              {
                "id": "unit",
                "value": "time: YYYY-MM-DD HH:mm:ss"
              },
              {
                "id": "custom.align"
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "REQUEST_API"
            },
            "properties": [
              {
                "id": "custom.width",
                "value": 323
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "REQUEST_ID"
            },
            "properties": [
              {
                "id": "custom.width",
                "value": 274
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "MESSAGE"
            },
            "properties": [
              {
                "id": "custom.width",
                "value": 483
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "API_ERROR_CODE"
            },
            "properties": [
              {
                "id": "custom.width",
                "value": 159
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "USERNAME"
            },
            "properties": [
              {
                "id": "custom.width",
                "value": 122
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "API_NAME"
            },
            "properties": [
              {
                "id": "custom.width",
                "value": 280
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "CREATE_DATE"
            },
            "properties": [
              {
                "id": "custom.width",
                "value": 162
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "INTERNAL_FAILIURE_REASON"
            },
            "properties": [
              {
                "id": "custom.width",
                "value": 420
              }
            ]
          }
        ]
      },
      "gridPos": {
        "h": 8,
        "w": 24,
        "x": 0,
        "y": 8
      },
      "id": 6,
      "options": {
        "cellHeight": "sm",
        "footer": {
          "countRows": false,
          "enablePagination": true,
          "fields": "",
          "reducer": [
            "sum"
          ],
          "show": false
        },
        "showHeader": true,
        "sortBy": []
      },
      "pluginVersion": "12.0.2",
      "targets": [
        {
          "dataset": "amx_cdr_database",
          "datasource": {
            "type": "mysql",
            "uid": "${DS_GCONTROL}"
          },
          "editorMode": "code",
          "format": "table",
          "rawQuery": true,
          "rawSql": "SELECT  API_NAME,CREATE_DATE, USERNAME, REQUEST_ID, REQUEST_API, MESSAGE, API_ERROR_CODE,  INTERNAL_FAILIURE_REASON\nfrom amx_gcontrol.auditlog_api_transaction\n where  $__timeFilter(CREATE_DATE)\n and result='Failed'\n order by CREATE_DATE desc\n",
          "refId": "A",
          "sql": {
            "columns": [
              {
                "parameters": [],
                "type": "function"
              }
            ],
            "groupBy": [
              {
                "property": {
                  "type": "string"
                },
                "type": "groupBy"
              }
            ],
            "limit": 50
          }
        }
      ],
      "title": "Error Detail",
      "transformations": [
        {
          "id": "merge",
          "options": {
            "reducers": []
          }
        }
      ],
      "type": "table"
    }
  ],
  "schemaVersion": 41,
  "tags": [
    "api"
  ],
  "templating": {
    "list": [
      {
        "allowCustomValue": false,
        "current": {},
        "description": "Choose the InfluxDB data source",
        "label": "Select Data Source",
        "name": "InfluxDS",
        "options": [],
        "query": "influxdb",
        "refresh": 1,
        "regex": "",
        "type": "datasource"
      }
    ]
  },
  "time": {
    "from": "now-3h",
    "to": "now"
  },
  "timepicker": {
    "refresh_intervals": [
      "5m",
      "15m",
      "30m",
      "1h",
      "2h",
      "1d"
    ]
  },
  "timezone": "browser",
  "title": "API Stats External",
  "uid": "777yesselapiStats",
  "version": 13,
  "weekStart": ""
}
}