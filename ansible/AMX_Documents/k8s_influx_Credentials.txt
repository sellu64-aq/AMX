[root@DLVMTMAMXK8SMAST02 ~]# kubectl -n monitoring create secret generic influxdb-creds \
  --from-literal=INFLUX_URL=http://10.221.92.106:8086 \
  --from-literal=INFLUX_DB=k8s_metrics \
  --from-literal=INFLUX_USER=telegraf \
  --from-literal=INFLUX_PWD='Telegraf@123'

### to stop /start telegraf temporaily ###
kubectl -n monitoring delete daemonset telegraf
kubectl -n monitoring delete daemonset telegraf-infra
kubectl apply -f telegraf-daemonset.yaml
kubectl apply -f telegraf-infra-daemonset.yaml

## To use new telegraf image ###
kubectl -n monitoring set image daemonset/telegraf telegraf=telegraf:1.30.1
kubectl apply -f telegraf-daemonset.yaml
kubectl -n monitoring rollout restart daemonset telegraf

### usefull config commands ####
kubectl apply -f telegraf-config.yaml
kubectl -n monitoring rollout restart daemonset telegraf
kubectl -n monitoring rollout status daemonset/telegraf
kubectl -n monitoring get pods -l app=telegraf -o wide

kubectl -n monitoring delete pod -l app=telegraf
kubectl -n monitoring logs -l app=telegraf --tail=100 | grep -i "kube_inventory\|error"
kubectl -n monitoring logs $(kubectl -n monitoring get pod -l app=telegraf -o name | head -1)
kubectl -n monitoring exec -it $(kubectl -n monitoring get pod -l app=telegraf -o name | head -1) -- telegraf --test --config /etc/telegraf/telegraf.conf
kubectl -n monitoring logs telegraf-9p6zd --previous

### to test live metrics inside pod ###
kubectl -n monitoring exec -it \
$(kubectl -n monitoring get pod -l app=telegraf -o name | head -1) -- \
sh -c 'NODE=$NODE_NAME; \
curl -ks -H "Authorization: Bearer $(cat /var/run/secrets/kubernetes.io/serviceaccount/token)" \
https://kubernetes.default.svc:443/api/v1/nodes/$NODE/proxy/metrics | head -n 20'

kubectl -n monitoring exec -it \
$(kubectl -n monitoring get pod -l app=telegraf -o name | head -1) -- \
sh -c 'curl -ks -H "Authorization: Bearer $(cat /var/run/secrets/kubernetes.io/serviceaccount/token)" \
https://kubernetes.default.svc/api/v1/nodes | head -n 20'



### to cehck available telegraf plugin list ####
kubectl -n monitoring exec -it $(kubectl -n monitoring get pod -l app=telegraf -o name | head -n1) -- telegraf --input-list | grep kube

#### Daemonset commands ####
vi telegraf-daemonset.yaml
kubectl -n monitoring apply -f telegraf-daemonset.yaml
kubectl -n monitoring rollout restart daemonset telegraf
kubectl -n monitoring get pods -l app=telegraf -o wide

#### rbac comamnd ###
vi telegraf-rbac.yaml
kubectl apply -f telegraf-rbac.yaml
kubectl -n monitoring rollout restart daemonset telegraf


kubectl -n monitoring exec -it $(kubectl -n monitoring get pod -l app=telegraf -o name | head -1) -- \
  curl -sSk -H "Authorization: Bearer $(cat /var/run/secrets/kubernetes.io/serviceaccount/token)" \
  https://kubernetes.default.svc/api/v1/nodes | head



