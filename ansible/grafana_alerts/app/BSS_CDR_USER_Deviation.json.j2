{
  "uid": "{{ alert_uid }}",
  "folderUID": "{{ folder_uid }}",
  "ruleGroup": "{{ rulegroup }}",
  "title": "BSS High Deviation Detected: CDR Count vs USER Requests",
  "condition": "C",
  "data": [
    {
      "refId": "A",
      "relativeTimeRange": {"from": 180, "to": 0},
      "datasourceUid": "{{ datasourceUid }}",
      "model": {
        "datasource": {"type": "influxdb", "uid": "{{ datasourceUid }}"},
        "instant": false,
        "intervalMs": 1000,
        "maxDataPoints": 43200,
        "query": "SELECT\n  sum(\"CDRCounts\")\nFROM \"thirty_days\".\"CQ_Access_Logs_1m\"\nWHERE $timeFilter and api_name  = 'UserRequest' OR api_name  = 'CDR'\nGROUP BY time(1m),api_name,project,zone,host,api_name fill(null)\n",
        "rawQuery": true,
        "refId": "A",
        "resultFormat": "time_series"
      }
    },
    {
      "refId": "B",
      "relativeTimeRange": {"from": 0, "to": 0},
      "datasourceUid": "__expr__",
      "model": {
        "conditions": [
          {
            "evaluator": { "params": [0, 0], "type": "gt" },
            "operator": {"type": "and"},
            "query": {"params": []},
            "reducer": {"params": [], "type": "avg"},
            "type": "query"
          }
        ],
        "datasource": {
          "name": "Expression",
          "type": "__expr__",
          "uid" : "__expr__"
        },
        "expression": "A",
        "hide": false,
        "reducer": "median",
        "refId": "B",
        "settings": {"mode": "dropNN"},
        "type": "reduce"
      }
    },
    {
      "refId": "C",
      "relativeTimeRange": {"from": 0, "to": 0},
      "datasourceUid": "__expr__",
      "model": {
        "conditions": [
          {
            "evaluator": { "params": [500, 0], "type": "lt" },
            "operator": {"type": "and"},
            "query": {"params": []},
            "reducer": {"params": [], "type": "avg"},
            "type": "query",
            "unloadEvaluator": { "params": [1000, 0], "type": "gt" }
          }
        ],
        "datasource": {
          "name": "Expression",
          "type": "__expr__",
          "uid" : "__expr__"
        },
        "expression": "B",
        "hide": false,
        "refId": "C",
        "type": "threshold"
      }
    }
  ],
  "noDataState": "OK",
  "execErrState": "KeepLast",
  "annotations": {
    "description": "This alert indicates a significant deviation between the number of user requests received and the number of CDR (Call Detail Record) entries processed by the BSS system. Such deviation can result in data inconsistency, revenue leakage, or billing inaccuracies if not resolved promptly.\n\nüß† Possible Causes:\nApplication logic failure in request-to-CDR conversion\nQueue/message broker delays or drops\nPartial failures in BSS services (e.g., CDR module not processing)\nOutage or high latency in DB or file system handling CDR\nJVM memory/GC pauses affecting CDR generation\n\nüîç Troubleshooting Steps:\nCheck BSS application logs (esp. catalina.out) for errors related to:\nCDR module\nRequest processing\nQueue consumption\n\nCheck queue/message broker (Kafka, ActiveMQ, etc.) status if applicable.\nVerify disk space and inode usage on CDR storage path (e.g., /cdr, /mnt/cdr)\nCheck for high memory, CPU, or GC activity on the BSS app servers.\nCross-verify Telegraf/Prometheus metrics for gaps or missing data.\nValidate that the CDR processing service/module is running.\n\nüîß Recommended Actions:\nRestart the affected CDR processing module only if logs show it's unresponsive or hung\nIf queue is backed up, consider manually purging/replaying messages\nRaise to L3/Delivery support if:\nDeviation persists beyond X minutes\nCDRs are not generated for multiple users\nTrigger service restart with caution ‚Äì confirm impact\n\nüìé Notes for L1/L2 Ops:\nConfirm if alert is still active after 5‚Äì10 minutes\nEscalate to Application Team with logs and metrics attached\nInclude time window, hostnames, and relevant graph screenshots in ticket/email"
  },
  "labels": {
    "platform": "{{ project }}",
    "zone"    : "{{ zone }}",
    "severity": "CRITICAL",
    "type"    : "{{ (rulegroup | string).split('_')[0] }}"
  },
  "isPaused": false
}

