{
  "uid": "{{ alert_uid }}",
  "folderUID": "{{ folder_uid }}",
  "ruleGroup": "{{ rulegroup }}",
  "title": "Spark LiveListenerBus - Processing Spike",
  "condition": "E",
  "data": [
    {
      "refId": "A",
      "relativeTimeRange": {"from": 900, "to": 0},
      "datasourceUid": "{{ datasourceUid }}",
      "model": {
        "datasource": {"type": "influxdb", "uid": "{{ datasourceUid }}"},
        "instant": true,
        "intervalMs": 1000,
        "maxDataPoints": 43200,
        "query": "SELECT mean(\"livelistenerbus_listenerprocessingtime_org_apache_spark_status_appstatuslistener_max\") \nFROM \"spark_livelistenerbus\" \nWHERE $timeFilter \nGROUP BY time(1m),project, zone,host, nodeIP",
        "rawQuery": true,
        "refId": "A",
        "resultFormat": "time_series"
      }
    },
    {
      "refId": "B",
      "relativeTimeRange": {"from": 900, "to": 0},
      "datasourceUid": "fexo9rlesu6f4a",
      "model": {
        "datasource": {"type": "influxdb", "uid": "fexo9rlesu6f4a"},
        "hide": false,
        "query": "SELECT mean(\"livelistenerbus_listenerprocessingtime_org_apache_spark_heartbeatreceiver_max\") \nFROM \"spark_livelistenerbus\" \nWHERE $timeFilter \nGROUP BY time(1m),zone,project, host, nodeIP",
        "rawQuery": true,
        "refId": "B",
        "resultFormat": "time_series"
      }
    },
    {
      "refId": "C",
      "relativeTimeRange": {"from": 0, "to": 0},
      "datasourceUid": "__expr__",
      "model": {
        "conditions": [
          {
            "evaluator": { "params": [0, 0], "type": "gt" },
            "operator": {"type": "and"},
            "query": {"params": []},
            "reducer": {"params": [], "type": "avg"},
            "type": "query"
          }
        ],
        "datasource": {
          "name": "Expression",
          "type": "__expr__",
          "uid" : "__expr__"
        },
        "expression": "A",
        "hide": false,
        "reducer": "last",
        "refId": "C",
        "type": "reduce"
      }
    },
    {
      "refId": "D",
      "relativeTimeRange": {"from": 0, "to": 0},
      "datasourceUid": "__expr__",
      "model": {
        "conditions": [
          {
            "evaluator": { "params": [0, 0], "type": "gt" },
            "operator": {"type": "and"},
            "query": {"params": []},
            "reducer": {"params": [], "type": "avg"},
            "type": "query"
          }
        ],
        "datasource": {
          "name": "Expression",
          "type": "__expr__",
          "uid" : "__expr__"
        },
        "expression": "B",
        "hide": false,
        "reducer": "last",
        "refId": "D",
        "type": "reduce"
      }
    },
    {
      "refId": "E",
      "relativeTimeRange": {"from": 0, "to": 0},
      "datasourceUid": "__expr__",
      "model": {
        "conditions": [
          {
            "evaluator": { "params": [0, 0], "type": "gt" },
            "operator": {"type": "and"},
            "query": {"params": []},
            "reducer": {"params": [], "type": "avg"},
            "type": "query"
          }
        ],
        "datasource": {
          "name": "Expression",
          "type": "__expr__",
          "uid" : "__expr__"
        },
        "expression": "($C \u003e 1000) || ($D \u003e 500)",
        "hide": false,
        "refId": "E",
        "type": "math"
      }
    }
  ],
  "noDataState": "OK",
  "execErrState": "Error",
  "annotations": {
    "description": "Description:\nMaximum processing time has spiked severely (\u003e1s for AppStatus or \u003e500ms for \nHeartbeat). Indicates major processing stall. May cause downstream issues.\n\nAction to Take:\n1. IMMEDIATE: Check for GC pauses in driver logs\n2. Review driver system metrics (CPU, I/O)\n3. Check for disk latency issues\n4. Review JVM heap usage and GC activity\n5. Check for blocking operations in listeners\n6. Monitor for executor timeouts (if heartbeat affected)\n7. Consider driver JVM tuning if GC-related\n8. Review application for blocking operations"
  },
  "labels": {
    "platform": "{{ project }}",
    "zone"    : "{{ zone }}",
    "severity": "CRITICAL",
    "type"    : "{{ (rulegroup | string).split('_')[0] }}"
  },
  "isPaused": false
}
